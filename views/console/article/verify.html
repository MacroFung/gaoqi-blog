{% extends "../layout.html" %}

{% block css %}
<link rel="stylesheet" href="/css/console/article.list.css"/>
{% endblock %}

{% block body %}
<div class="wrapper wrapper-content animated ">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>文章审核</h5>
        </div>
        <div class="ibox-content">
          <div>
            <div class="row">
              <div class="col-sm-3">
                <div class="row">
                  <form action="/console/articles/verify">
                    <div class="col-lg-5 pr-5">
                      <input placeholder="输入标题查询" class="input-sm form-control" type="text" name="title" id="name" value="{{ title }}" />
                    </div>
                    <div class="col-lg-5 pl-5 pr-5">
                      <select name="category_id" class="form-control input-sm">
                        <option value="">选择栏目</option>
                        {% for category in categories %}
                        <option value="{{category.id}}" {{ 'selected="selected"' if category.id == category_id }}>{{ '　' if category.pid != null }}{{ category.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-lg-2">
                      <button type="submit" class="btn btn-sm btn-primary">查询</button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-lg-9">
                <a href="/console/articles/verify" class="btn btn-primary btn-sm">全部</a>
                <a href="/console/articles/create" class="btn btn-primary btn-sm">发布文章</a>
              </div>
            </div>
          </div>
          <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
              <th width="5%" class="text-center">序号</th>
              <th width="30%" class="text-center">标题</th>
              <th width="10%" class="text-center">栏目</th>
              <th width="10%" class="text-center">发布者</th>
              <th width="5%" class="text-center">浏览量</th>
              <th width="10%" class="text-center">最后编辑</th>
              <th class="text-center">操作</th>
            </tr>
            </thead>
            <tbody>
            {% for article in articles %}
            <tr>
              <td class="text-center">{{ loop.index }}</td>
              <td><a href="/console/articles/{{article.id}}/edit">{{ article.title }}</a></td>
              <td class="text-center">{{ article.category.name }}</td>
              <td class="text-center">{{ article.user.alias }}</td>
              <td>{{ article.pv }}</td>
              <td class="text-center">{{ article.update_time | datetime }}</td>
              <td>
                <a class="btnVerify btn btn-primary btn-xs" data-id="{{ article.id }}">通过审核</a>
                <a class="btnRemove btn btn-danger btn-xs" data-id="{{ article.id }}">删除</a>
              </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="10"><div class="text-center"><span>暂时没有内容</span></div></td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
          {% include '../paging.html' %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
$('.btnVerify').click(function() {
  var id = $(this).data('id');

  if (!confirm('是否要通过审核此文章?')) {
    return;
  }

  $.ajax({
    type: 'POST',
    url: '/console/articles/verified',
    data: { ids: id }
  })
  .done(function(result) {
    if (result.success) {
      location.reload();
    } else {
      toastr.error('', result.message);
    }
  })
  .fail(function() {
    toastr.error('', '通过审核失败')
  })
})

$('.btnRemove').click(function() {
  var id = $(this).data('id');

  if (!confirm('是否要删除此文章?')) {
    return;
  }

  $.ajax({
    url: '/console/articles/' + id + '/remove',
  })
  .done(function(result) {
    if (result.success) {
      location.reload();
    } else {
      toastr.error('', result.message);
    }
  })
  .fail(function() {
    toastr.error('', '删除失败')
  })
})
</script>
{% endblock %}